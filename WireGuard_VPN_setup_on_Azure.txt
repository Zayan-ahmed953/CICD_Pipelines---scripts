I have a Vnet with 1 pub and 1 prv subnet
we have a bastion in pub subnet and a prv instance in prv subnet, prv instance only allows connection from bastion host prvate ip only
Then in pub subnet we have another vm for wireguard 

bastion only allows acces from wireguards pub IP
wireguard vm is exposed to internet 





On wireguard server 


[Interface]
PrivateKey = <SERVER_PRIVATE_KEY>
Address = 10.10.0.1/24
ListenPort = 51820

[Peer]
PublicKey = <CLIENT_PUBLIC_KEY>
AllowedIPs = 10.10.0.2/32






On client server


[Interface]
PrivateKey = <CLIENT_PRIVATE_KEY>
Address = 10.10.0.2/32
DNS = 1.1.1.1

[Peer]
PublicKey = <SERVER_PUBLIC_KEY>
Endpoint = <WireGuard_VM_Public_IP>:51820
AllowedIPs = 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
PersistentKeepalive = 25







Enable Routing on WireGuard VM

echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p





Add NAT & Forwarding Rules


sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -i wg0 -j ACCEPT
sudo iptables -A FORWARD -o wg0 -j ACCEPT





Start wireguard

sudo systemctl enable wg-quick@wg0
sudo systemctl start wg-quick@wg0





Test the setup

ssh -i <bastion ssh key> azureuser@<Bastion_Private_IP>
